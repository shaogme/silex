# Silex

Silex æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºçš„ä¸‹ä¸€ä»£ Rust åº“ã€‚å®ƒæ·±å— **SolidJS** çš„ç»†ç²’åº¦å“åº”å¼è®¾è®¡å¯å‘ï¼Œä½†ä¸“ä¸º Rust è¯­è¨€ç‰¹æ€§è¿›è¡Œäº†ä¼˜åŒ–ã€‚å®ƒæ‘’å¼ƒäº†è™šæ‹Ÿ DOM (VDOM)ï¼Œé€šè¿‡ä¿¡å· (Signal) å’Œå‰¯ä½œç”¨ (Effect) ç›´æ¥é©±åŠ¨çœŸå® DOM çš„æ›´æ–°ï¼Œä»è€Œå®ç°æè‡´çš„æ€§èƒ½ã€‚

Silex çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ **"Rusty & Fluent"** â€”â€” æä¾›ä¸€å¥—ç¬¦åˆ Rust ç¼–ç¨‹ä¹ æƒ¯çš„ã€ç±»å‹å®‰å…¨çš„ã€åŸºäºæ„å»ºè€…æ¨¡å¼ (Builder Pattern) çš„ APIï¼Œè€Œä¸æ˜¯è¿‡åº¦ä¾èµ–å®æˆ–ä¸ºäº†æ¨¡ä»¿ JSX è€Œç‰ºç‰² Rust çš„å¼ºç±»å‹ä¼˜åŠ¿ã€‚

## ğŸŒŸ æ ¸å¿ƒè®¾è®¡æ€è·¯ (Design Philosophy)

### 1. æ— è™šæ‹Ÿ DOM (No VDOM) & ç»†ç²’åº¦å“åº”å¼
Silex ä¸ä½¿ç”¨è™šæ‹Ÿ DOM Diff ç®—æ³•ã€‚ç›¸åï¼Œå®ƒé‡‡ç”¨ç»†ç²’åº¦çš„å“åº”å¼ç³»ç»Ÿã€‚
- **å³æ—¶æ›´æ–°**ï¼šå½“çŠ¶æ€ (Signal) å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªæœ‰ä¾èµ–è¯¥çŠ¶æ€çš„å…·ä½“ DOM å±æ€§æˆ–æ–‡æœ¬èŠ‚ç‚¹ä¼šæ›´æ–°ï¼Œä¸ä¼šæœ‰ç»„ä»¶çº§çš„é‡æ¸²æŸ“å¼€é”€ã€‚
- **ç²¾ç¡®ä¾èµ–è¿½è¸ª**ï¼šç³»ç»Ÿè‡ªåŠ¨æ”¶é›†ä¾èµ–å…³ç³»ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨å£°æ˜ä¾èµ–æ•°ç»„ã€‚

### 2. æµå¼æ„å»ºè€… API (Fluent Builder API)
Silex æå€¡ä½¿ç”¨**æ„å»ºè€…æ¨¡å¼**æ¥ç»„è£… UIï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç±»ä¼¼ JSX çš„å®ã€‚
- **ç±»å‹å®‰å…¨**ï¼šæ‰€æœ‰å±æ€§ã€æ ·å¼å’Œäº‹ä»¶ç»‘å®šéƒ½æ˜¯ç±»å‹æ£€æŸ¥çš„ã€‚
- **IDE å‹å¥½**ï¼šåˆ©ç”¨ Rust å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œæä¾›ä¼˜ç§€çš„ä»£ç è¡¥å…¨å’Œé‡æ„ä½“éªŒã€‚
- **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šç»„ä»¶ä»…ä»…æ˜¯å®ç°äº† `View` ç‰¹å¾çš„ç»“æ„ä½“æˆ–å‡½æ•°ï¼Œæ˜“äºç»„åˆã€‚

```rust
// ç¤ºä¾‹ï¼šæµå¼ API
div()
    .class("container")
    .style("display: flex")
    .child(
        button()
            .on_click(|| println!("Clicked!"))
            .text("Click Me")
    )
```

### 3. å¤šæ€å±æ€§ä¸è§†å›¾ (Polymorphic Attributes & Views)
Silex å……åˆ†åˆ©ç”¨ Rust çš„ Trait ç³»ç»Ÿï¼Œä½¿å¾— API æå…·çµæ´»æ€§ï¼š
- **å±æ€§å¤šæ€**ï¼š`attr`ã€`id` ç­‰æ–¹æ³•ä¸ä»…æ¥å—é™æ€å­—ç¬¦ä¸²ï¼Œè¿˜æ¥å— `Signal`ã€é—­åŒ…ç­‰ã€‚å¦‚æœæ˜¯å“åº”å¼æ•°æ®ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨å»ºç«‹ç»‘å®šã€‚
- **è§†å›¾å¤šæ€**ï¼š`View` ç‰¹å¾å®ç°äº†å¯¹åŸºç¡€ç±»å‹ï¼ˆæ•°å­—ã€å¸ƒå°”ï¼‰ã€å­—ç¬¦ä¸²ã€å…ƒç»„ï¼ˆç”¨äºç‰‡æ®µï¼‰ã€`Option`ã€`Vec` ç­‰çš„å¹¿æ³›æ”¯æŒï¼Œä½¿å¾— UI ç»“æ„å®šä¹‰éå¸¸è‡ªç„¶ã€‚

## ğŸ—ï¸ è®¾è®¡æ¶æ„ä¸å®ç° (Architecture & Implementation)

Silex çš„æ¶æ„ä¸»è¦ç”±ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š**Reactivity (å“åº”å¼æ ¸å¿ƒ)**ã€**DOM (è§†å›¾å±‚)** å’Œ **Flow (æ§åˆ¶æµ)**ã€‚

### 1. å“åº”å¼æ ¸å¿ƒ (`src/reactivity`)
è¿™æ˜¯é©±åŠ¨æ•´ä¸ªæ¡†æ¶çš„å¼•æ“ï¼Œä½äº `silex/src/reactivity.rs` å’Œ `runtime.rs`ã€‚

- **Runtime (è¿è¡Œæ—¶)**ï¼š
    - **Split Store æ¶æ„**ï¼šä½¿ç”¨ `SlotMap` å­˜å‚¨å“åº”å¼èŠ‚ç‚¹æ‹“æ‰‘ï¼Œé…åˆ `SecondaryMap` åˆ†ç¦»å­˜å‚¨ Signal æ•°æ®å’Œ Effect é€»è¾‘ã€‚è¿™ç§æ•°æ®å±€éƒ¨æ€§ä¼˜åŒ–æé«˜äº†ç¼“å­˜æ•ˆç‡ã€‚
    - **BFS Update Queue**ï¼šä½¿ç”¨å¹¿åº¦ä¼˜å…ˆé˜Ÿåˆ—è°ƒåº¦å‰¯ä½œç”¨æ›´æ–°ï¼Œä¸ä»…é¿å…äº†æ·±å±‚ä¾èµ–å¯¼è‡´çš„æ ˆæº¢å‡ºï¼Œè¿˜ç¡®ä¿äº†æ›´æ–°é¡ºåºçš„å¯é¢„æµ‹æ€§ã€‚
    - **ç¨³å®šå¼•ç”¨**ï¼šé€šè¿‡ `NodeId` å¥æŸ„è®¿é—®èŠ‚ç‚¹ï¼Œå·§å¦™é¿å¼€äº† Rust çš„å€Ÿç”¨æ£€æŸ¥å™¨é™åˆ¶ï¼Œå®ç°äº†çµæ´»çš„ååº”å¼å›¾ç»“æ„ã€‚

- **Dependency Tracking (ä¾èµ–è¿½è¸ª)**ï¼š
    - **è‡ªåŠ¨æ”¶é›†**ï¼šåœ¨å‰¯ä½œç”¨æ‰§è¡ŒæœŸé—´è¯»å– Signal ä¼šè‡ªåŠ¨è®°å½•ä¾èµ–ã€‚
    - **åŠ¨æ€ä¿®å‰ª**ï¼šæ¯æ¬¡ Effect é‡æ–°è¿è¡Œæ—¶ä¼šæ¸…ç©ºæ—§ä¾èµ–å¹¶é‡æ–°æ”¶é›†ï¼Œç¡®ä¿ä¾èµ–å›¾å§‹ç»ˆç²¾ç¡®æœ€å°ã€‚
    - **O(1) å»é‡**ï¼šåˆ©ç”¨ç‰ˆæœ¬å·æœºåˆ¶ï¼ˆVersioningï¼‰å®ç°é«˜æ•ˆçš„ä¾èµ–æŸ¥é‡ï¼Œé¿å…é‡å¤æ³¨å†Œã€‚

- **Scope System (ä½œç”¨åŸŸç³»ç»Ÿ)**ï¼š
    - æ ‘çŠ¶å±‚çº§ç®¡ç† (`Owner/Parent-Child`)ã€‚
    - **è‡ªåŠ¨åƒåœ¾å›æ”¶**ï¼šå½“ Scope è¢«é”€æ¯æ—¶ï¼Œé€’å½’æ¸…ç†æ‰€æœ‰å­èŠ‚ç‚¹ï¼ˆSignal, Effectï¼‰å¹¶è§¦å‘ `on_cleanup` å›è°ƒï¼Œæœ‰æ•ˆé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

- **Primitives (åŸè¯­)**ï¼š
    - `create_signal`: åˆ›å»ºåŸºç¡€çš„è¯»å†™ä¿¡å·å¯¹ã€‚
    - `create_rw_signal`: åˆ›å»ºåˆå¹¶äº†è¯»å†™åŠŸèƒ½çš„ä¿¡å·å¯¹è±¡ã€‚
    - `create_effect`: åˆ›å»ºè‡ªåŠ¨è¿½è¸ªä¾èµ–çš„å‰¯ä½œç”¨ã€‚
    - `create_memo`: åˆ›å»ºå¸¦ç¼“å­˜çš„æ´¾ç”Ÿä¿¡å·ï¼Œé€šè¿‡ `PartialEq` å‡å°‘ä¸‹æ¸¸ä¸å¿…è¦çš„æ›´æ–°ã€‚
    - `create_resource`: é›†æˆ `Future` çš„å¼‚æ­¥èµ„æºï¼Œå†…ç½®é˜²ç«æ€æœºåˆ¶ï¼ˆRequest IDï¼‰å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
    - `untrack`: åœ¨ä¸è¢«è¿½è¸ªçš„æƒ…å†µä¸‹è¯»å–ä¿¡å·ã€‚
    - `provide_context` / `use_context`: åŸºäºç±»å‹ ID çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿã€‚

### 2. DOM æŠ½è±¡å±‚ (`src/dom`)
è¿™ä¸€å±‚è¿æ¥å“åº”å¼ç³»ç»Ÿä¸æµè§ˆå™¨çš„ `web-sys` APIã€‚

- **Element (`dom/element.rs`)**ï¼š
    - å¯¹ `web_sys::Element` çš„è½»é‡çº§åŒ…è£…ã€‚
    - æä¾›äº† `.attr()`, `.style()`, `.on_click()` ç­‰é“¾å¼æ–¹æ³•ã€‚
    - **æ™ºèƒ½ç»‘å®š**ï¼šä¾‹å¦‚ `attr` æ–¹æ³•æ¥æ”¶ `impl AttributeValue`ã€‚å¦‚æœä¼ å…¥çš„æ˜¯ `ReadSignal`ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå†…éƒ¨ Effect æ¥ä¿æŒ DOM å±æ€§ä¸ Signal åŒæ­¥ï¼›å¦‚æœä¼ å…¥çš„æ˜¯é™æ€å€¼ï¼Œåˆ™åªè®¾ç½®ä¸€æ¬¡ã€‚
- **View Trait (`dom/view.rs`)**ï¼š
    - å®šä¹‰äº† `mount(self, parent: &Node)` æ–¹æ³•ã€‚
    - å®ç°äº†å¯¹ Rust åŸç”Ÿç±»å‹ã€é›†åˆç±»å‹å’Œé—­åŒ…çš„æ¸²æŸ“æ”¯æŒã€‚
    - é—­åŒ…ä½œä¸º View æ—¶ï¼ˆ`Fn() -> impl View`ï¼‰ï¼Œè¢«è§†ä¸º"æƒ°æ€§è§†å›¾"ï¼Œç»“åˆ `create_effect` å¯å®ç°åŠ¨æ€æ–‡æœ¬æ›´æ–°ã€‚
- **Suspense (`dom/suspense.rs`)**ï¼š
    - ç»“åˆ `SuspenseContext`ï¼Œé€šè¿‡ç›‘æ§å¼‚æ­¥ä»»åŠ¡è®¡æ•°å™¨ï¼Œåœ¨æ•°æ®åŠ è½½æ—¶è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤º `fallback` è§†å›¾å’Œå®é™… `children` è§†å›¾ã€‚

### 3. æ§åˆ¶æµç»„ä»¶ (`src/flow`)
Silex ä¸ä½¿ç”¨ç¼–è¯‘å™¨é­”æ³•å¤„ç† `if` æˆ– `for`ï¼Œè€Œæ˜¯æä¾›é«˜æ•ˆçš„ç»„ä»¶ã€‚

- **Show (`flow/show.rs`)**ï¼š
    - æ¡ä»¶æ¸²æŸ“ç»„ä»¶ã€‚
    - æä¾›äº† `.when(condition).otherwise(fallback)` çš„è¯­æ³•ç³–ã€‚
    - ä¼˜åŒ–ï¼šå½“æ¡ä»¶å˜åŒ–æ—¶ï¼ŒåªæŒ‚è½½/å¸è½½å¿…è¦çš„åˆ†æ”¯ã€‚
- **For (`flow/for_loop.rs`)**ï¼š
    - åˆ—è¡¨æ¸²æŸ“ç»„ä»¶ã€‚
    - **Keyed Diffing**ï¼šé€šè¿‡ `key` å‡½æ•°è¿½è¸ªåˆ—è¡¨é¡¹ã€‚å½“åˆ—è¡¨æ•°æ®å˜åŒ–æ—¶ï¼Œå®ƒä¼šå¯¹æ¯”æ–°æ—§ key é›†åˆï¼Œä»…å¯¹æ–°å¢ã€åˆ é™¤æˆ–ç§»åŠ¨çš„é¡¹è¿›è¡Œ DOM æ“ä½œï¼Œå¤ç”¨å·²æœ‰çš„ DOM èŠ‚ç‚¹å’Œ Scopeï¼Œæ€§èƒ½è¿œè¶…å…¨é‡é‡å»ºã€‚
- **Dynamic (`flow/dynamic.rs`)**ï¼š
    - é€šç”¨åŠ¨æ€ç»„ä»¶ï¼Œæ ¹æ®é—­åŒ…è¿”å›çš„ View ç±»å‹åŠ¨æ€åˆ‡æ¢å†…å®¹ã€‚

### 4. è·¯ç”±ç³»ç»Ÿ (`src/router`)
`Router` ç»„ä»¶æä¾›äº†å®¢æˆ·ç«¯å¯¼èˆªèƒ½åŠ›ï¼Œæ— éœ€é¡µé¢åˆ·æ–°ã€‚
- **å£°æ˜å¼é…ç½®**ï¼šé€šè¿‡é“¾å¼ API å®šä¹‰è·¯ç”±è§„åˆ™ã€‚
- **æ—  VDOM**ï¼šè·¯ç”±åˆ‡æ¢æ—¶ç›´æ¥æŒ‚è½½/å¸è½½ DOM èŠ‚ç‚¹ï¼Œä¸ä¾èµ– VDOM Diffã€‚
- **RouterContext**ï¼šæä¾› `use_navigate`, `use_params` ç­‰ Hooks æ–¹ä¾¿åœ¨ä»»ä½•ç»„ä»¶ä¸­è·å–è·¯ç”±çŠ¶æ€ã€‚

## ğŸ“ æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ

| æ¨¡å— | è·¯å¾„ | æè¿° |
|------|------|------|
| **Dom** | `dom/element.rs`, `dom/attribute.rs` | DOM å…ƒç´ å°è£…ã€å±æ€§ç»‘å®šé€»è¾‘ã€SVGæ”¯æŒã€‚ |
| **View** | `dom/view.rs` | `View` ç‰¹å¾å®šä¹‰åŠé’ˆå¯¹å„ç±» Rust ç±»å‹çš„å®ç°ã€‚ |
| **Reactivity** | `reactivity.rs`, `reactivity/runtime.rs` | ä¿¡å·ã€å‰¯ä½œç”¨ã€Scope ç®¡ç†ã€è¿è¡Œæ—¶çŠ¶æ€ã€‚ |
| **Flow** | `flow/show.rs`, `flow/for_loop.rs` | `Show` (if), `For` (loop) ç­‰æ§åˆ¶æµçš„é«˜æ•ˆå®ç°ã€‚ |
| **Router** | `router.rs`, `router/matcher.rs` | å®¢æˆ·ç«¯è·¯ç”±ï¼Œæ”¯æŒå‚æ•°åŒ¹é…å’Œ History API é›†æˆã€‚ |
| **Suspense** | `dom/suspense.rs` | å¼‚æ­¥è¾¹ç•Œå¤„ç†ï¼Œæ”¯æŒ Loading çŠ¶æ€å›é€€ã€‚ |

## ğŸš€ ç¤ºä¾‹ä»£ç 

ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Props Builder æ¨¡å¼ã€Routerã€Context API å’Œæ§åˆ¶æµç»„ä»¶æ¥æ„å»ºåº”ç”¨ï¼š

```rust
use silex::prelude::*;

fn main() {
    create_scope(move || {
        let (count, set_count) = create_signal(0);
        // å…¨å±€çŠ¶æ€æ³¨å…¥
        provide_context(count); 

        div()
            .class("app")
            .child((
                // å¯¼èˆªæ 
                nav().child((
                    link("/").text("Home"),
                    link("/about").text("About"),
                )),

                // è·¯ç”±é…ç½®
                Router::new()
                    .route("/", || HomeView())
                    .route("/about", || AboutView())
                    .fallback(|| NotFound())
            ))
            .mount(&document.body().unwrap());
    });
}

fn HomeView() -> impl View {
    // ä½¿ç”¨ Context
    let count = use_context::<ReadSignal<i32>>().unwrap();

    div().child((
        h1().text("Home"),
        p().text(move || format!("Global Count: {}", count.get().unwrap()))
    ))
}
```

## ğŸ› ï¸ å½“å‰çŠ¶æ€

Silex ç›®å‰å¤„äº **Alpha** é˜¶æ®µã€‚
- âœ… æ ¸å¿ƒå“åº”å¼ç³»ç»Ÿ (Signal, Effect, Memo, Scope)
- âœ… åŸºç¡€ DOM ç»‘å®š (Attr, Event, Style)
- âœ… æ ¸å¿ƒæ§åˆ¶æµ (Show, For, Dynamic)
- âœ… å®¢æˆ·ç«¯è·¯ç”± (Router) ä¸å‚æ•°åŒ¹é…
- âœ… å¼‚æ­¥èµ„æºä¸ Suspense
- âœ… Context API
- ğŸš§ SSR (æœåŠ¡ç«¯æ¸²æŸ“) - å°šæœªå®ç°
- ğŸš§ Hydration - å°šæœªå®ç°
