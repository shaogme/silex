# Silex 内部开发文档编写指南

本目录 (`docs/src/dev_docs`) 专门用于存放 **Silex 框架内部实现原理** 的深度技术文档。
这些文档面向的是 **框架的核心贡献者** 以及希望深入理解 Silex 内部运作机制的 **高级用户**。

为了保持文档的一致性和深度，所有 `dev_docs` 下的模块分析文档 **必须** 严格遵循以下结构撰写。

## 1. 概要 (Overview)

在此部分，你需要简要介绍该文档所描述的模块或功能组件。

*   **定义**：用一两句话清晰地定义该模块是什么（例如：“DOM Diff 算法核心”、“响应式信号调度器”）。
*   **作用**：说明它在 Silex 整体架构中扮演的角色，以及它与其他核心模块（如 `silex_core`, `silex_dom`）的高层交互关系。
*   **目标受众**：如果有特定的前置知识要求（例如：“阅读本文前建议先了解 Rust 的 `Pin` 和 `Future` 机制”），请在此注明。

## 2. 理念和思路 (Philosophy and Design)

这是文档中最重要的部分之一，解释“为什么”要这样设计。

*   **设计背景**：是为了解决什么特定的痛点？（例如：性能瓶颈、API 易用性、类型安全）。
*   **核心思想**：列出该模块遵循的设计原则（例如：“零成本抽象”、“细粒度响应式”、“无虚拟 DOM”）。
*   **方案取舍 (Trade-offs)**：
    *   我们在设计过程中考虑过哪些替代方案？
    *   为什么最终选择了当前的实现路径？
    *   当前的方案有什么优势，又带来了哪些必须接受的妥协？
*   **参考来源**：如果借鉴了其他框架（如 SolidJS, Vue, Leptos）的设计灵感，请在此致谢并说明改进之处。

## 3. 模块内结构 (Internal Structure)

在此部分，详细描述模块的代码组织方式和静态结构。

*   **目录结构**：列出关键的文件和目录，并说明它们的职责。
    ```text
    src/
    ├── signal.rs       // 信号的基础原语实现
    ├── effect.rs       // 副作用管理与调度
    └── memo.rs         // 计算属性的缓存逻辑
    ```
*   **核心组件关系**：使用文字或图表（推荐 Mermaid）描述主要 `struct`、`trait` 和 `enum` 之间的关系。
    *   谁拥有谁？（Ownership）
    *   谁引用谁？（References）
    *   数据流向是怎样的？

## 4. 代码详细分析 (Detailed Analysis)

这是文档的核心技术部分，需要深入代码细节。

*   **关键数据结构**：对核心 `struct` 的字段进行逐一解释，特别是那些看起来不直观的字段（例如：`PhantomData` 的用途，位压缩的标志位）。
    ```rust
    pub struct Signal<T> {
        // 解释为什么这里需要用 UnsafeCell
        value: UnsafeCell<T>, 
        // 解释 subscribers 的存储策略
        subscribers: RefCell<SparseSet>, 
    }
    ```
*   **核心算法与流程**：
    *   分析关键方法（如 `poll`, `update`, `diff`）的执行步骤。
    *   不要只是把代码翻译成中文，要解释**逻辑背后的意图**。
    *   对于复杂的控制流或状态机，请配合伪代码或流程图进行讲解。
*   **难点解析**：
    *   **Unsafe 代码**：如果模块中包含 `unsafe` 代码，必须详细解释其安全边界（Safety Checklist）和不变量（Invariants）。
    *   **特殊技巧**：解释用到的 Rust 高级特性或模式（如 GATs, HRTB, Type Erasure）。

## 5. 存在的问题和 TODO (Issues and TODOs)

诚实地记录当前实现的不足和未来的改进计划。

*   **已知限制 (Limitatons)**：当前版本不支持的边缘情况，或者已知的 Bug。
*   **性能瓶颈**：如果有尚未优化的热点路径，请详细指明。
*   **重构计划**：如果某些代码是临时的（Workaround），请说明理想的重构方向。
*   **待办事项 (TODOs)**：列出具体的改进任务，最好能关联到 GitHub Issue。

---

**注意**：撰写文档时，请务必保证代码引用的准确性。随着代码库的演进，请记得同步更新文档。
